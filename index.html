<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Fus√©e Spatiale Deluxe</title>
<style>
body {margin:0;padding:0;height:100vh;overflow:hidden;font-family:Arial,sans-serif;background:linear-gradient(180deg,#000428,#004e92);color:white;}
#gameContainer{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
canvas{background:radial-gradient(circle,#001a33,#000);border:3px solid #00d4ff;box-shadow:0 0 30px #00d4ff80;}
#screen{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#000000dd;z-index:10;}
button{padding:12px 35px;margin:8px;font-size:20px;border:none;border-radius:50px;cursor:pointer;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-weight:bold;}
input{padding:12px 20px;font-size:18px;border:2px solid #00d4ff;border-radius:25px;background:#ffffff22;color:white;text-align:center;}
#scoreDisplay{position:absolute;top:20px;left:20px;font-size:24px;}
#pauseBtn{position:absolute;top:20px;right:20px;display:none;}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="scoreDisplay" style="display:none;">Score: <span id="score">0</span></div>
  <button id="pauseBtn" style="display:none;">‚è∏ Pause</button>
  <div id="screen"><h1>üöÄ Fus√©e Spatiale üöÄ</h1><button id="startBtn">D√©marrer</button></div>
  <canvas id="game" width="600" height="800"></canvas>
</div>
<script>
// ===== VARIABLES =====
let screen=document.getElementById("screen");
let canvas=document.getElementById("game");
let ctx=canvas.getContext("2d");
let scoreDisplay=document.getElementById("scoreDisplay");
let pauseBtn=document.getElementById("pauseBtn");
let scoreSpan=document.getElementById("score");

let pseudo="", mode="solo", difficulty="easy";
let score=0;
let gameRunning=false, gamePaused=false;
let keys={};

let player={x:280,y:740,w:40,h:60,shield:false,laser:false};
let asteroids=[], bonuses=[], iaPlayers=[], particleList=[], lasers=[];
let asteroidSpawnTimer=0, asteroidSpawnInterval=60;
let laserCooldown=0;
let BONUS_INTERVAL=100, nextBonusTrigger=100;

// ===== SOUNDS =====
const laserSound=new Audio("sounds/laser.mp3");
const bonusSound=new Audio("sounds/bonus.mp3");
const explosionSound=new Audio("sounds/explosion.mp3");
const shieldSound=new Audio("sounds/shield.mp3");
laserSound.volume=.6; bonusSound.volume=.9; explosionSound.volume=.9; shieldSound.volume=.8;

// ===== EVENTS =====
document.addEventListener("keydown",e=>{keys[e.code]=true;});
document.addEventListener("keyup",e=>{keys[e.code]=false;});
document.getElementById("startBtn").onclick=menuPseudo;
pauseBtn.onclick=togglePause;

// ===== PARTICULES =====
function spawnParticles(x,y,color,size,count){
  for(let i=0;i<count;i++){
    particleList.push({x,y,dx:(Math.random()*2-1)*2,dy:(Math.random()*2-1)*2,life:30,size,color});
  }
}
function drawParticles(){
  particleList.forEach((p,i)=>{
    p.x+=p.dx; p.y+=p.dy; p.life--;
    ctx.globalAlpha=p.life/30;
    ctx.fillStyle=p.color;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
    if(p.life<=0) particleList.splice(i,1);
  });
}

// ===== MENUS =====
function menuPseudo(){
  screen.innerHTML=`
  <h1>üöÄ Fus√©e Spatiale üöÄ</h1>
  <p>Entrez votre pseudo:</p>
  <input id="pseudoInput" maxlength="15"/>
  <button id="validatePseudo">Valider</button>`;
  document.getElementById("validatePseudo").onclick=()=>{
    pseudo=document.getElementById("pseudoInput").value||"Joueur";
    menuMain();
  };
}
function menuMain(){
  screen.innerHTML=`
  <h1>üöÄ Fus√©e Spatiale üöÄ</h1>
  <p>Bonjour ${pseudo}!</p>
  <button id="soloBtn">Solo</button>
  <button id="multiBtn">Multijoueur</button>`;
  document.getElementById("soloBtn").onclick=startSolo;
  document.getElementById("multiBtn").onclick=menuMulti;
}
function menuMulti(){
  screen.innerHTML=`
  <h1>üöÄ Mode Multi</h1>
  <p>Choisir difficult√© IA</p>
  <button id="easyBtn">Facile</button>
  <button id="mediumBtn">Moyen</button>
  <button id="hardBtn">Difficile</button>`;
  document.getElementById("easyBtn").onclick=()=>startMulti("easy");
  document.getElementById("mediumBtn").onclick=()=>startMulti("medium");
  document.getElementById("hardBtn").onclick=()=>startMulti("hard");
}

// ===== INIT GAME =====
function startSolo(){mode="solo"; initGame();}
function startMulti(diff){mode="multi"; difficulty=diff; initGame();}

function initGame(){
  screen.style.display="none";
  score=0; scoreSpan.textContent=score;
  asteroids=[]; bonuses=[]; particleList=[]; lasers=[];
  player={x:280,y:740,w:40,h:60,shield:false,laser:false};
  gameRunning=true; gamePaused=false;
  asteroidSpawnInterval=(mode==="multi"&&difficulty==="hard"?40:60);
  scoreDisplay.style.display="block"; pauseBtn.style.display="block";
  nextBonusTrigger=100;
  if(mode==="multi") initIA();
  requestAnimationFrame(update);
}

function initIA(){
  const colors=["#ff6b6b","#ffd93d","#6bcf7f","#a29bfe"];
  const names=["Astro","Nova","Cosmos","Stellar"];
  iaPlayers=[];
  for(let i=0;i<4;i++){
    iaPlayers.push({
      x:100+i*120,y:740,w:40,h:60,color:colors[i],name:names[i],
      alive:true,dir:0,speed:(difficulty==="hard"?5:(difficulty==="medium"?4:2)),
      shield:false,laser:false
    });
  }
}

// ===== CONTROLES =====
function movePlayer(){
  if(keys.ArrowLeft&&player.x>0) player.x-=6;
  if(keys.ArrowRight&&player.x+player.w<canvas.width) player.x+=6;
  if(keys.ArrowUp&&player.y>0) player.y-=4;
  if(keys.ArrowDown&&player.y+player.h<canvas.height) player.y+=4;

  if(keys.Space && player.laser && laserCooldown<=0){
    shootLaser(player);
  }
}

// ===== TIR =====
function shootLaser(p){
  laserCooldown=15;
  laserSound.currentTime=0; laserSound.play();
  lasers.push({x:p.x+p.w/2,y:p.y,w:4,h:20});
}

// ===== ASTEROIDS & BONUS =====
function spawnAsteroid(){
  let s=20+Math.random()*30;
  asteroids.push({x:Math.random()*(canvas.width-s),y:-s,w:s,h:s,speed:2+Math.random()*2+(score/500)});
}
function spawnBonus(){
  let type=["shield","laser","score"][Math.floor(Math.random()*3)];
  let s=30;
  let icon = type==="shield"?"üõ°Ô∏è":type==="laser"?"üî´":"üèÜ";
  bonuses.push({x:Math.random()*(canvas.width-s),y:-s,w:s,h:s,speed:3,type,icon});
}
function useBonus(p,type){
  bonusSound.currentTime=0; bonusSound.play();
  let duration=15000; // 15 secondes
  if(type==="shield"){shieldSound.currentTime=0; shieldSound.play(); p.shield=true; setTimeout(()=>p.shield=false,duration);}
  if(type==="laser"){p.laser=true; setTimeout(()=>p.laser=false,duration);}
  if(type==="score"){score+=100; scoreSpan.textContent=score;}
}

// ===== DRAW FUS√âE =====
function drawRocket(p,color){
  ctx.save(); 
  ctx.translate(p.x+p.w/2,p.y+p.h/2);

  // Corps fus√©e avec d√©grad√©
  let grad=ctx.createLinearGradient(0,-p.h/2,0,p.h/2);
  grad.addColorStop(0,"#00d4ff");
  grad.addColorStop(0.7,"#004080");
  grad.addColorStop(1,"#001a33");
  ctx.fillStyle=color||grad;
  ctx.beginPath();
  ctx.moveTo(0,-p.h/2);
  ctx.lineTo(p.w/2,p.h/2);
  ctx.lineTo(-p.w/2,p.h/2);
  ctx.closePath();
  ctx.fill();

  // Ailettes anim√©es
  let wingOffset=Math.sin(Date.now()/100)*2;
  ctx.fillStyle="#ff4500";
  ctx.beginPath();
  ctx.moveTo(-p.w/2,p.h/2); ctx.lineTo(-p.w/2-10+wingOffset,p.h/2+15); ctx.lineTo(-p.w/2,p.h/2); ctx.closePath(); ctx.fill();
  ctx.beginPath();
  ctx.moveTo(p.w/2,p.h/2); ctx.lineTo(p.w/2+10+wingOffset,p.h/2+15); ctx.lineTo(p.w/2,p.h/2); ctx.closePath(); ctx.fill();

  // Fen√™tre cockpit
  ctx.fillStyle="#87CEEB";
  ctx.beginPath(); ctx.arc(0,0,p.w*0.15,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="rgba(255,255,255,0.4)";
  ctx.beginPath(); ctx.arc(-p.w*0.05,-p.h*0.05,p.w*0.05,0,Math.PI*2); ctx.fill();

  ctx.restore();

  // Flamme dynamique
  spawnParticles(p.x+p.w/2,p.y+p.h/2+20,"#ffaa00",2+Math.random()*2,2+Math.floor(Math.random()*3));
  spawnParticles(p.x+p.w/2,p.y+p.h/2+20,"#ff3300",2+Math.random()*2,1+Math.floor(Math.random()*2));
}

// ===== COLLISION =====
function hit(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}

// ===== UPDATE =====
function update(){
  if(!gameRunning||gamePaused) return;
  ctx.clearRect(0,0,600,800);

  // √©toiles
  ctx.fillStyle="white";
  for(let i=0;i<40;i++){let x=(i*137)%600, y=((i*137+score*2)%800); ctx.fillRect(x,y,2,2);}

  movePlayer();
  if(laserCooldown>0) laserCooldown--;

  // Dessiner et d√©placer lasers
  lasers.forEach((l,i)=>{
    l.y-=15;
    ctx.fillStyle="#ff3300";
    ctx.fillRect(l.x-2,l.y,l.w,l.h);
    asteroids.forEach((a,j)=>{
      if(hit(l,a)){
        // Explosion rouge-orang√©e
        for(let k=0;k<15;k++){
          particleList.push({x:a.x+a.w/2,y:a.y+a.h/2,dx:(Math.random()*2-1)*2,dy:(Math.random()*2-1)*2,life:30,size:4,color:"#ff5500"});
        }
        explosionSound.currentTime=0; explosionSound.play();
        asteroids.splice(j,1); lasers.splice(i,1);
        score+=10; scoreSpan.textContent=score;
      }
    });
    if(l.y<-20) lasers.splice(i,1);
  });

  spawnParticles(player.x+player.w/2,player.y+player.h,"#ffaa00",2,2);
  drawParticles();

  // Spawn asteroids
  asteroidSpawnTimer++;
  if(asteroidSpawnTimer>=asteroidSpawnInterval){
    spawnAsteroid();
    asteroidSpawnTimer=0;
    if(asteroidSpawnInterval>25) asteroidSpawnInterval-=0.4;
  }

  // Bonuses
  if(score>=nextBonusTrigger){spawnBonus(); nextBonusTrigger+=BONUS_INTERVAL;}
  bonuses.forEach((b,i)=>{b.y+=b.speed; ctx.font="28px Arial"; ctx.fillText(b.icon,b.x,b.y+b.h); if(hit(player,b)){useBonus(player,b.type); bonuses.splice(i,1);}});

  // Asteroids collision player
  asteroids.forEach((a,i)=>{
    a.y+=a.speed;
    if(a.y>800){asteroids.splice(i,1); score+=10; scoreSpan.textContent=score;}
    ctx.fillStyle="#888"; ctx.beginPath();
    ctx.arc(a.x+a.w/2,a.y+a.h/2,a.w/2,0,Math.PI*2); ctx.fill();
    if(hit(player,a)){if(player.shield){spawnParticles(a.x,a.y,"#00caff",4,15); asteroids.splice(i,1);} else endGame();}
  });

  drawRocket(player);

  // IA
  if(mode==="multi"){
    iaPlayers.forEach(ai=>{
      if(!ai.alive) return;
      if(Math.random()<.03) ai.dir=(Math.random()<.5?-1:1);
      ai.x+=ai.dir*ai.speed; ai.x=Math.max(0,Math.min(canvas.width-ai.w,ai.x));
      spawnParticles(ai.x+ai.w/2,ai.y+ai.h,"#ffaa00",2,2);
      drawRocket(ai,ai.color);
      asteroids.forEach(a=>{if(hit(ai,a)){if(ai.shield){spawnParticles(a.x,a.y,"#00caff",4,15); a.y=9999;} else ai.alive=false;}});
    });
  }

  scoreSpan.textContent=score;
  requestAnimationFrame(update);
}

// ===== END GAME =====
function endGame(){
  gameRunning=false;
  pauseBtn.style.display="none"; scoreDisplay.style.display="none";
  screen.style.display="flex";
  screen.innerHTML=`
    <h1>GAME OVER</h1>
    <p>Score: ${score}</p>
    <button onclick="initGame()">Rejouer</button>
    <button onclick="menuMain()">Menu</button>
  `;
}

// ===== PAUSE =====
function togglePause(){
  gamePaused=!gamePaused;
  if(gamePaused){
    screen.style.display="flex";
    screen.innerHTML=`
      <h1>‚è∏ PAUSE ‚è∏</h1>
      <button onclick="resumeGame()">Reprendre</button>
      <button onclick="menuMain()">Menu</button>
    `;
  } else {
    screen.style.display="none";
    requestAnimationFrame(update);
  }
}
function resumeGame(){screen.style.display="none"; gamePaused=false; requestAnimationFrame(update);}
</script>
</body>
</html>
